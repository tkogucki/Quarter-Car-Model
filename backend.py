import pandas as pd

g = 32.2

# dictionary for index values for excel spreadhseet
front_xls = {
    'kt' : 1,
    'k' : 2,
    'damp': 3,
    'usprung': 5,
    'sprung' : 7,
    'MR' : 9
}

rear_xls = {
    'kt' : 1,
    'k' : 3,
    'damp': 4,
    'usprung': 6,
    'sprung' : 8,
    'MR' : 10
}

simulation_xls = {
    'Speed' : 0,
    'Height' : 1,
    'Radius' : 2
}

# returns value of index series generated by pandas
def l(df, i, string):
    ind = df.index
    return df.loc[ind[i], string]

# vehicle parameter class
class vehicle:
    # import function for class
    def __init__(self,df, file):
        df = df.set_index('Parameter')
        self.file = file
        self.front = vehicle.axles(df, 'front', self)
        self.rear = vehicle.axles(df, 'rear', self)
    # sublass for the parameters on each axle
    class axles:
        def __init__(self, df, axle, car):
            v = 'Value'
            if axle == 'front':
                self.kt = l(df, front_xls['kt'], v) * 12
                self.k = l(df, front_xls['k'],v) * 12
                self.damp = vehicle.damper(car, l(df, front_xls['damp'], v))
                self.usprung = l(df, front_xls['usprung'], v) / g
                self.sprung = l(df, front_xls['sprung'], v) / g
                self.MR = l(df, front_xls['MR'], v)
            elif axle == 'rear':
                self.kt = l(df, rear_xls['kt'], v) * 12
                self.k = l(df, rear_xls['k'],v) * 12
                self.damp = vehicle.damper(car, l(df, rear_xls['damp'], v))
                self.usprung = l(df, rear_xls['usprung'], v) / g
                self.sprung = l(df, rear_xls['sprung'], v) / g
                self.MR = l(df,rear_xls['MR'],v)

    # sub class of vehicle that describes the dampers
    class damper:
        # takes in input of car class, and targeted sheet for extraction of data
        def __init__(self, car, damp_val):
            pd_damper = pd.read_excel(car.file, header = 0, sheet_name = damp_val)
            self.speed = pd_damper['Speed'] * 1/12
            self.force = pd_damper['Force']
            self.length = self.speed.size
            slope_top = self.force.iloc[self.length - 1] - self.force.iloc[self.length - 2]
            slope_bottom = self.speed.iloc[self.length - 1] - self.speed.iloc[self.length - 2]
            self.slope = slope_top/slope_bottom
            # maximum allowable damping force
            self.max_damp = self.slope * (1.2 * self.speed.iloc[self.length - 1] - self.speed.iloc[self.length - 1]) + self.force.iloc[self.length - 1]

# class for creating all of the simulation parameters and values       
class simulation:
    # import function for class
    def __init__(self,df, file):
        v = 'Value'
        df = df.set_index('Parameter')
        self.file = file
        self.v_speed = l(df, simulation_xls['Speed'], v) * 1.466
        self.step_height = l(df, simulation_xls['Height'], v) / 12
        self.tire_radius = l(df, simulation_xls['Radius'], v) / 12



        

# generation of a vehicle
def vehicle_generator(file):
    param_df = pd.read_excel(file, header = 0, sheet_name = 'Vehicle_Param')
    car = vehicle(param_df, file)
    print('   Vehicle Parameters Imported Successfully')
    param_df2 = pd.read_excel(file, header = 0, sheet_name = 'Simulation')
    sim = simulation(param_df2, file)
    print('   Simulation Parameters Imported Successfully')
    return car, sim

# write your test code here and execute
if __name__ == '__main__':
    car, sim= vehicle_generator('driver.xlsx')
    print(car.rear.usprung)
    print(car.front.damp.speed)
    print(f'Car motion ratio: {car.rear.MR}')
    length = car.front.damp.length
    print(car.front.damp.speed.iloc[length-1])
    print(sim.v_speed)